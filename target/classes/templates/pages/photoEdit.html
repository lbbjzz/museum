<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/layout::head"></head>
<body class="hold-transition  sidebar-mini bg-black ">
<div class="wrapper">
    <!-- 顶部导航栏 Navbar -->
    <nav th:replace="fragments/layout::topNav"></nav>
    <!-- 侧边导航栏 Main Sidebar Container -->
    <aside th:replace="fragments/layout::leftAside"></aside>

    <!--页面内容 Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 class="text-dark">文物拍照</h1>
                    </div>
                    <!--   面包屑-->
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                            <li class="breadcrumb-item active">文物拍照</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <!-- 页面主要内容Main content -->
        <div class="content">
            <div class="container-fluid">
                <!-- 内容 -->

                <div class="row" style="color: black;">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">

                                <div style="width: 100%;height: 40px;float: left;margin-top: 5px;margin-bottom: 10px">
                                    <input type="button" title="开启摄像头" value="开启摄像头" onclick="getMedia()" style="color: #fff;background: #0a90f5;outline: none;border-width:0px;width: 25%;height: 30px;border-radius:10px;"/>
                                    <button onclick="takePhoto()" style="color: #fff;background: #0a90f5;outline: none;border-width:0px;width: 25%;height: 30px;border-radius:10px;margin-left: 12%">拍照</button>
                                    <button style="color: #fff;background: #0a90f5;outline: none;border-width:0px;width: 25%;height: 30px;border-radius:10px;margin-left: 12%" type="submit" onclick="zby()">确认并保存</button>
                                </div>
                                <form th:method="post" action="photo" name="addForm">
                                    <div class="row">
                                        <div class="mb-3 col-md-6" style="width: 50%">
                                            <label>文物编号 <span class="text-danger">(*)</span></label>
                                            <input required min="1" name="imgId" id="imgFileName"
                                                   type="number" value="" placeholder="请在保存照片前输入文物编号" style="border:0.5px solid #378888;border-radius: 10px;width:80%;height: 30px;"/>
                                            <div class="invalid-feedback">文物编号必须大于0!</div>
                                        </div>
                                    </div>
                                </form>


                                <div style="width:30%;height:310px;float: left;margin-left: 10%">
                                    <video id="video" width="300px" height="300px" autoplay="autoplay"></video>
                                </div>
                                <div style="width:30%;height:310px;float: left;margin-left: 20%" class="test">
                                    <canvas id="canvas" width="300px" height="300px"></canvas>
                                </div>


                            </div>
                            <!-- /.card-body -->
                        </div>
                        <!-- /.card -->
                    </div>
                </div>

            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content -->
    </div>

    <!-- 底部页脚Footer -->
    <footer class="main-footer" th:replace="fragments/layout::footer"></footer>
</div>


<script type="text/javascript">
    //获得video摄像头区域
    let video = document.getElementById("video");
    function getMedia() {
        let constraints = {
            video: {width: 300, height: 300},
            audio: false
        };
        let promise = navigator.mediaDevices.getUserMedia(constraints);
        promise.then(function (MediaStream) {
            video.srcObject = MediaStream;
            video.play();
        }).catch(function (PermissionDeniedError) {
            console.log(PermissionDeniedError);
        })
    }
    function takePhoto() {
        //获得Canvas对象
        let canvas = document.getElementById("canvas");
        let ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, 300, 300);

    }
    function zby() {

        var canvas = document.getElementById("canvas");
        var dataURL=canvas.toDataURL(image/png);
        var imageDate=keyFrameDataUrl.substring(22);
        $.ajax({
            type:'post',
            url:'/photo',
            data:'dataURL='+imageDate,
            async:false,
            success:function () {

            }
        })
    }
</script>

</body>
</html>
